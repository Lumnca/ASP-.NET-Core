# :partly_sunny:应用程序状态 #

<p id="t"></p>

:one:[应用程序状态的可选方式](#a1)

:two:[使用HTTPContext.Items](#a2)

<p id="a1"></p>

### :arrow_forward:应用程序状态的可选方式 ### 

:arrow_double_up:[返回目录](#t)

应用程序状态指的是用于描述应用程序当前状态的任意数据。包括全局数据和用户特有的数据。ASP.NET Core 具有以下几种可选方式：

**HTTPContext.Items**

当数据仅用于一个请求中时，用Items集合存储是最佳的方法。数据在每个请求结束之后被丢弃。它是组件和中间件在一个请求期间的不同时间点进行相互通信的最加手段。

**Cookies**

与状态有关的非常小量的数据可以存储在Cookies中。他们会随每次请求被发送，所以应该保持在最小的尺寸，理想情况下应该只使用一个标识符，而真正的数据存在服务端的某处，键值与这个标识相关联。

**Session**

会话（Session）存储依靠一个基于Cookies的标识符来访问给定浏览器会话相关的数据。每建立一个连接，就创立了一个会话。会话断开，数据也就清除。

<p id="a2"></p>

### :arrow_forward:使用HTTPContext.Items ### 

:arrow_double_up:[返回目录](#t)

HTTPContext抽象的提供了一个简单的键值对类型的字典集合，叫做Items。在每个请求中，这个集合从HTTPRequest开始就可以起作用，直到请求结束被丢弃，想要存取集合，可以直接给键赋值，或者根据给定键查询值。如下，在中间件中设置全局变量Author：

```C#
            app.Use(async (context, next) =>
            {
                context.Items["Author"] = "Lumnca";
                await next.Invoke();
            });
```

这样在全局任何位置都能访问：

```C#
    public class HomeController : Controller
    {
        public IActionResult Index()
        {
            ViewBag.author = HttpContext.Items["Author"];
            return View();
        }
    }
```

当然你也可以在使用完后销毁变量：

```C#
        public IActionResult Index()
        {
            ViewBag.author = HttpContext.Items["Author"];
            HttpContext.Items.Remove("Author");
            return View();
        }
```










